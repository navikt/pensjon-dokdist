== Systemdiagram
:imagesdir: images
Applikasjonsdiagrammet viser hvilke andre systemer systemet snakker med.

image::pensjon-dokdist.png[pensjon-dokdist,png]

NOTE: STS og on-premise servicebruker er erstattet med AzureAD. Spring Security sørger for login-flow
og utveksler access-token mot on-behalf-of token til SAF, Dokarkiv og DistribuerJournalpost.

NOTE: Har ikke tilgang til kilden for bildet over, så det er ikke oppdatert med Brevmetadata og AzureAD.

|===
|Steg |Input |Output |Beskrivelse

|1

PSAK -> Pensjon-dokdist
|journalpostId

journalpostStatus
|
|Url i PSAK inneholder journalpostId og journalpostStatus.
Lenken leder til pensjon-dokdist.

|2

Pensjon-dokdist -> SAF
|journalpostId
|journalfoerendEnhet

dokumenter[].brevkode

|Kall mot GraphQL-tjeneste SAF og hente journalfoerendEnhet og brevkode som trenges for å ferdigstille journalpost.

|[line-through]#3#

[line-through]#Pensjon-dokdist -> STS#
|
|[line-through]#serviceBrukerToken#
|[line-through]#Kall mot Rest-tjeneste STS og hente serviceBrukerToken som trenges for å ferdigstille journalpost.#

|4

Pensjon-dokdist -> Brevmetadata
|brevkode
|dokumentkategori
|Om brevet ikke er fritekst (hvor saksbehandler selv velger), så utledes distribusjonstype ut fra dokumentkategori.

|5
Pensjon-dokdist -> Dokarkiv
|journalpostId

journalfoerendEnhet
|
|Kall mot Rest-tjeneste Dokarkiv og ferdigstille journalpost. Status til journalpost blir satt til 'FS'.

|6

Pensjon-dokdist -> DistribuerJournalpost
|journalpostId

bestillendeFagsystem

dokumentProdApp

distribusjonstype

distribusjonstidspunkt

|bestillingsId
|Kall mot Rest-tjeneste DistribuerJournalpost. Det blir sendte tilbake en bestillingsId hvis brev er distribuert.
Forusetningen er at journalpost har status 'FS'

|6
|===
